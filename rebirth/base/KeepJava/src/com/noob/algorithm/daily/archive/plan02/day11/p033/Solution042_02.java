package com.noob.algorithm.daily.archive.plan02.day11.p033;

import java.util.Stack;

/**
 * ğŸ”´ 042 æ¥é›¨æ°´ - https://leetcode.cn/problems/trapping-rain-water/description/
 */
public class Solution042_02 {

    /**
     * æ€è·¯åˆ†æï¼šè®¡ç®—æ¯ä¸ªæ ¼å­çš„æ¥æ°´é‡
     * - å•è°ƒæ ˆæ€è·¯ï¼š
     * - â‘  å•è°ƒæ ˆå­˜å‚¨ä»€ä¹ˆï¼Ÿ ä¸‹æ ‡ç´¢å¼•
     * - â‘¡ å•è°ƒæ ˆçš„é¡ºåºï¼Ÿ  ä»æ ˆå¤´åˆ°æ ˆåº•ï¼ˆä»å°åˆ°å¤§ï¼‰
     * - â‘¢ å•è°ƒæ ˆåˆ¤æ–­ æ ¡éªŒå½“å‰éå†é«˜åº¦ä¸æ ˆé¡¶æŒ‡å‘ç´¢å¼•å…ƒç´ æ¯”è¾ƒï¼ˆcurValã€topValï¼‰
     * - (1) curVal<topVal å…ƒç´ å…¥æ ˆ
     * - (2) curVal == topVal æ›´æ–°æ ˆé¡¶å…ƒç´ ï¼ˆé‡åˆ°ç›¸åŒçš„æŸ±å­åˆ™ä»¥å³è¾¹æŸ±å­ä¸ºå‚è€ƒè®¡ç®—å®½åº¦ï¼‰
     * - (3) curVal>topVal å‡ºç°å‡¹æ§½ï¼Œéœ€è¦è®¡ç®—ä¸æ°´é‡
     * - a.ç¬¬1ä¸ªæ ˆé¡¶å…ƒç´ ï¼ˆå‡¹æ§½åº•éƒ¨ç´¢å¼•ï¼ˆå³å³ä¾§æŸ±å­çš„å‰ä¸€ä¸ªæŸ±å­ï¼‰ï¼šç›¸åŒçš„é«˜åº¦å·²ç»è¢«è¦†ç›–æ›´æ–°ï¼Œæ­¤å¤„å¯å¾—åˆ°å®½åº¦ï¼‰
     * - b.ç¬¬2ä¸ªæ ˆé¡¶å…ƒç´ ï¼ˆå‡¹æ§½å·¦ä¾§æŸ±å­ç´¢å¼•ï¼‰
     */
    public int trap(int[] height) {
        int n = height.length;
        // æ„å»ºæ ˆè¾…åŠ©éå†
        Stack<Integer> st = new Stack<>();
        st.push(0); // åˆå§‹åŒ–åŠ å…¥ç´¢å¼•

        int cnt = 0;

        // éå†å…ƒç´ 
        for (int i = 1; i < n; i++) {
            // æ ¡éªŒæ ˆé¡¶å…ƒç´ s
            if (height[st.peek()] > height[i]) {
                // å…ƒç´ æ­£å¸¸å…¥æ ˆ
                st.push(i);
            } else if (height[st.peek()] == height[i]) {
                // æ›´æ–°æ ˆé¡¶å…ƒç´ ï¼ˆé‡åˆ°ç›¸åŒçš„æŸ±å­ï¼‰
                st.pop();
                st.push(i);
            } else {
                while (!st.isEmpty() && height[st.peek()] < height[i]) {
                    /**
                     *  å¦‚æœé‡åˆ°æ¯”æ ˆé¡¶é«˜çš„æŸ±å­ï¼Œè¯´æ˜æ­¤æ—¶å‡ºç°å‡¹æ§½ï¼Œæ›´æ–°é›¨æ°´é‡
                     *  1."å–å‡º"(pop)ç¬¬1ä¸ªæ ˆé¡¶å…ƒç´ ä¸ºåº•éƒ¨æŸ±å­ç´¢å¼•
                     *  2."è·å–"(peek)ç¬¬2ä¸ªæ ˆé¡¶å…ƒç´ ä¸ºå·¦ä¾§æŸ±å­ç´¢å¼•
                     *  3.å½“å‰éå†å…ƒç´ iä¸ºå³ä¾§æŸ±å­ç´¢å¼•
                     */
                    int midIdx = st.pop(); // åº•éƒ¨æŸ±å­ç´¢å¼•
                    // NPE å¤„ç†(é¿å…å–ä¸åˆ°ç¬¬2ä¸ªå…ƒç´ )
                    if (!st.isEmpty()) {
                        // è®¡ç®—å½“å‰æŸ±å­æ„æˆçš„å‡¹æ§½æ‰€æ¥çš„é›¨æ°´é‡
                        int w = i - st.peek() - 1; // è®¡ç®—å®½åº¦
                        int h = Math.min(height[st.peek()], height[i]) - height[midIdx]; // å·¦å³ä¾§æŸ±å­ä¸­é€‰æ‹©æœ€ä½çš„é«˜åº¦ å‡å» ä¸­é—´æŸ±å­çš„é«˜åº¦ å¾—åˆ°å‡¹æ§½æ¥é›¨æ°´çš„é«˜åº¦
                        cnt += w * h; // ç´¯åŠ æ¥é›¨æ°´é‡
                    }
                }
                // æ’å…¥å…ƒç´ 
                st.push(i);
            }
        }
        // è¿”å›ç»“æœ
        return cnt;
    }

}
